{"mappings":"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","sources":["scripts/main.js"],"sourcesContent":["/**\r\n * Funciones principales\r\n */\r\n\r\nlet aBalizas = [];\r\nlet oTiempo = {};\r\n\r\nlet sColorPrincipal = \"\";\r\nlet sColorSecundario = \"\";\r\n\r\nlet bLogueado = false;\r\n\r\nlet tTimeout;\r\n\r\nlet iconoDefecto;\r\n\r\n// Máximo de Marcadores guardados\r\nlet iMaxGuardados = 5;\r\n\r\n$(\"document\").ready(function () {\r\n  PreLogin();\r\n  if (bLogueado == true && usuario) {\r\n    console.log(usuario);\r\n    PostLogin();\r\n  } else {\r\n    MostrarLogin();\r\n  }\r\n});\r\n\r\n// Funciones antes del login\r\nfunction PreLogin() {\r\n  CargarLocalStorage();\r\n  CargarColorInicial();\r\n\r\n  CrearSlider();\r\n}\r\n\r\n// Funciones después del login\r\nfunction PostLogin() {\r\n  var promesa2 = GetOpcionesUsuario(usuario.id);\r\n  promesa2.then((res) => {\r\n    aGuardados = JSON.parse(res);\r\n    CargarAjustes();\r\n    OcultarLogin();\r\n    CargarMapa();\r\n    ObtenerBalizas();\r\n    setInterval(ActualizarDatos, 10000);\r\n  });\r\n}\r\n\r\n// Obtener todas las balizas\r\nfunction ObtenerBalizas() {\r\n  var promise = GetBalizas();\r\n  promise.then(function (data) {\r\n    aBalizas = JSON.parse(data);\r\n    CargarMarcadores();\r\n    CargarCartas(aGuardados);\r\n  });\r\n}\r\n\r\n// Obtener la baliza deseada\r\nfunction ObtenerTiempo(id) {\r\n  var promise = GetTiempo(id);\r\n  promise.then(function (data) {\r\n    oTiempo = JSON.parse(data);\r\n    AnadirCarta(oTiempo);\r\n  });\r\n}\r\n\r\n// Cambiar estado del mapa\r\n$(\"#mapTop\").click(() => {\r\n  $(\"#map\").toggle();\r\n});\r\n\r\nfunction MostrarLogin() {\r\n  $(\"#divBlur\").css(\"display\", \"flex\");\r\n  $(\"#divLoginContainer\").css(\"display\", \"flex\");\r\n  $(\"#divLogin\").css(\"display\", \"flex\");\r\n}\r\n\r\nfunction OcultarLogin() {\r\n  $(\"#divBlur\").css(\"display\", \"none\");\r\n  $(\"#divLoginContainer\").css(\"display\", \"none\");\r\n  $(\"#divLogin\").css(\"display\", \"none\");\r\n}\r\n\r\n// Mostrar carta de información en grande\r\nfunction MostrarCartaGrande(oTiempo) {\r\n  $(\"#divBlur\").show();\r\n  $(\"#divCartaGrande\").css(\"display\", \"flex\");\r\n  $(\"#grTitulo\").text(oTiempo.nombre);\r\n  $(\"#grTemperatura\").text(oTiempo.temperatura);\r\n  $(\"#grSensacionTermica\").text(oTiempo.sensacionTermica);\r\n  $(\"#grHumedad\").text(oTiempo.humedad);\r\n  $(\"#grPresionAtmosferica\").text(oTiempo.presionAtmosferica);\r\n  $(\"#grVelocidadViento\").text(oTiempo.velocidadViento);\r\n  $(\"#grHoraAmanecer\").text(new Date(parseInt(oTiempo.horaAmanecer) * 1000).customFormat(\"#hhhh#:#mm#\"));\r\n  $(\"#grHoraAtardecer\").text(new Date(parseInt(oTiempo.horaAtardecer) * 1000).customFormat(\"#hhhh#:#mm#\"));\r\n  $(\"#grLatitud\").text(oTiempo.latitud);\r\n  $(\"#grLongitud\").text(oTiempo.longitud);\r\n  $(\"#divBlur\").click(() => {\r\n    OcultarCartaGrande();\r\n  });\r\n  $(`#grImg`).attr(\"src\", `./images/${oTiempo.descripcion.toLowerCase()}-white.png`);\r\n  $(`#grFlecha`).attr(\"src\", `./images/arrow-${sColorPrincipal}.png`);\r\n  $(`#grFlecha`).css({ transform: \"rotate(\" + oTiempo.direccionViento + \"deg)\" });\r\n  console.log(oTiempo);\r\n}\r\n\r\nfunction OcultarCartaGrande() {\r\n  $(\"#divBlur\").hide();\r\n  $(\"#divCartaGrande\").css(\"display\", \"none\");\r\n  console.log(\"OCULTAR CARTA GRANDE\");\r\n}\r\n\r\n// Mostrar el error en el contenedor del mapa\r\nfunction MostrarError(error = limitError) {\r\n  clearTimeout(tTimeout);\r\n  $(\"#divError\").text(error);\r\n  // Mostrar error, esperar 2 segundos, ocultar\r\n  $(\"#divError\").removeClass(\"hidden\");\r\n  tTimeout = setTimeout(() => {\r\n    $(\"#divError\").addClass(\"hidden\");\r\n  }, 2000);\r\n}\r\n\r\n// Carga todas las cartas\r\nfunction CargarCartas(balizas) {\r\n  $(`#divContainer`).empty();\r\n  // if (oGuardados[test].length >= 0)\r\n  balizas.forEach((element) => {\r\n    ObtenerTiempo(element.codigoBaliza);\r\n  });\r\n}\r\n\r\nfunction CargarColorInicial() {\r\n  // Carga el color inicial según el local storage\r\n  let sValor, sValorSecundario;\r\n  aColores.forEach((element) => {\r\n    if (element.nombre == sColorPrincipal) {\r\n      sValor = element.valor;\r\n    }\r\n    if (element.nombre == sColorSecundario) sValorSecundario = element.valor;\r\n  });\r\n\r\n  CambiarColorPrimario(sColorPrincipal, sValor, true);\r\n  CambiarColorSecundario(sColorSecundario, sValorSecundario);\r\n}\r\n\r\nfunction CambiarColorPrimario(sColor, sValor, bInicio = false) {\r\n  sColorPrincipal = sColor;\r\n  // Cambia el color predominante de la web, cambiando la variable --main-color del css\r\n  localStorage.setItem(\"sColorPrimario\", sColor);\r\n  document.documentElement.style.setProperty(\"--main-color\", sValor);\r\n  iconoDefecto = L.icon({\r\n    iconUrl: `../images/marker-${sColor}.png`,\r\n    iconSize: [41, 41],\r\n  });\r\n  if (!bInicio) CargarMarcadores();\r\n  // document.getElementsByTagName(\"body\")[0].style.backgroundImage = `url('imagenes/background-${sColor}.png')`;\r\n}\r\n\r\nfunction CambiarColorSecundario(sColor, sValor) {\r\n  sColorSecundario = sColor;\r\n  localStorage.setItem(\"sColorSecundario\", sColor);\r\n  document.documentElement.style.setProperty(\"--secondary-color\", sValor);\r\n}\r\n\r\nfunction CargarAjustes() {\r\n  // Carga los botones de los colores != mainColor\r\n  let divColoresPrincipales = document.getElementById(\"divColoresPrincipales\");\r\n  let divColoresSecundarios = document.getElementById(\"divColoresSecundarios\");\r\n  divColoresPrincipales.innerHTML = \"\";\r\n  divColoresSecundarios.innerHTML = \"\";\r\n  $(`#textUser`).html(usuario.username);\r\n\r\n  sColorPrincipal = localStorage.getItem(\"sColorPrimario\");\r\n  sColorSecundario = localStorage.getItem(\"sColorSecundario\");\r\n  aColores.forEach((oColor) => {\r\n    // Si no es el color principal, añade el botón\r\n    divColoresPrincipales.innerHTML += `<button class=\"color-button color-button-small\" style=\"background-color: ${oColor.valor}\" onclick=\"CambiarColorPrimario('${oColor.nombre}', '${oColor.valor}')\"></button>`;\r\n    divColoresSecundarios.innerHTML += `<button class=\"color-button color-button-small\" style=\"background-color: ${oColor.valor}\" onclick=\"CambiarColorSecundario('${oColor.nombre}', '${oColor.valor}')\"></button>`;\r\n  });\r\n}\r\n\r\n$(`#btnLogout`).on(\"click\", () => {\r\n  Logout();\r\n});\r\n\r\n// Gif de ajustes en hover\r\n$(\".settings\").hover(function () {\r\n  $(this).css(\"background\", \"url(../images/settings.gif)\");\r\n  $(this).css(\"background-repeat\", \"no-repeat\");\r\n  $(this).css(\"background-position\", \"center\");\r\n  $(this).css(\"background-size\", \"3.5em\");\r\n});\r\n\r\n$(\".settings\").mouseleave(function () {\r\n  $(this).css(\"background\", \"url(../images/settings-stopped.gif)\");\r\n  $(this).css(\"background-repeat\", \"no-repeat\");\r\n  $(this).css(\"background-position\", \"center\");\r\n  $(this).css(\"background-size\", \"3.5em\");\r\n});\r\n\r\n// Eventos botón flotante\r\n$(\"#show\").on(\"mouseover\", function () {\r\n  $(\"#colores\").removeClass(\"hidden\");\r\n});\r\n$(\"#show\").on(\"mouseout\", function () {\r\n  $(\"#colores\").addClass(\"hidden\");\r\n});\r\n"],"names":["tTimeout","iconoDefecto","aBalizas","oTiempo1","sColorPrincipal","sColorSecundario","bLogueado","iMaxGuardados","PreLogin","CargarLocalStorage","CargarColorInicial","CrearSlider","PostLogin","GetOpcionesUsuario","usuario","id","then","res","aGuardados","JSON","parse","CargarAjustes","OcultarLogin","CargarMapa","ObtenerBalizas","setInterval","ActualizarDatos","GetBalizas","data","CargarMarcadores","CargarCartas","ObtenerTiempo","GetTiempo","AnadirCarta","MostrarLogin","$","css","MostrarCartaGrande","oTiempo","show","text","nombre","temperatura","sensacionTermica","humedad","presionAtmosferica","velocidadViento","Date","parseInt","horaAmanecer","customFormat","horaAtardecer","latitud","longitud","click","OcultarCartaGrande","attr","descripcion","toLowerCase","transform","direccionViento","log","hide","console","MostrarError","error","limitError","clearTimeout","removeClass","setTimeout","addClass","balizas","empty","forEach","element","codigoBaliza","sValor","sValorSecundario","valor","CambiarColorPrimario","sColor","bInicio","localStorage","setItem","documentElement","style","setProperty","L","icon","CambiarColorSecundario","divColoresPrincipales","document","getElementById","divColoresSecundarios","innerHTML","html","username","getItem","oColor","ready","toggle","on","Logout","hover","this","mouseleave"],"version":3,"file":"index.cf226876.js.map"}